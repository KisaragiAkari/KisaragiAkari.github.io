<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn-jp.imgs.moe/2023/09/07/64f916e42a582.png"><link rel="icon" href="https://cdn-jp.imgs.moe/2023/09/07/64f916e42a582.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#003153"><meta name="author" content="来宮揚羽"><meta name="keywords" content=""><meta name="description" content="聊聊状态压缩。 顾名思义，就是把一个状态压成一个整数，从而使得问题的所有状态可以度量。 一般都是用二进制状态压缩来表示子集与全集的关系，对应着二进制每一位都是 \(0\) 或 \(1\)。更高的进制能表示更多的信息，但状态的数量也会随之增加，并且实现的时候要自己手写位运算，较为复杂，本文不会涉及。 信息的表示 luogu7076 [CSP-S2020] 动物园 题意比较绕。 一个 \"><title>「NOIP Record」#9 状态压缩 - Kisaragi&#39;s blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"yozora0908.top",root:"/",version:"1.9.7",typing:{enable:!1,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:"#"},progressbar:{enable:!0,height_px:3,color:"#0076FF",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:null,onlypost:!0,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!1,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml",include_content_in_search:!0};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 7.1.0"><link rel="alternate" href="/atom.xml" title="Kisaragi's blog" type="application/atom+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Kisaragi&#39;s blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>花开何时</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item"><a class="nav-link" href="/links/" target="_self"><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://cdn-jp.imgs.moe/2023/09/07/64f916e5da678.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.2)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle">「NOIP Record」#9 状态压缩</span></div><div class="mt-3"></div><div class="mt-1"></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">「NOIP Record」#9 状态压缩</h1><div class="markdown-body"><p>聊聊状态压缩。</p><p>顾名思义，就是把一个状态压成一个整数，从而使得问题的所有状态可以度量。</p><p>一般都是用二进制状态压缩来表示子集与全集的关系，对应着二进制每一位都是 <span class="math inline">\(0\)</span> 或 <span class="math inline">\(1\)</span>。更高的进制能表示更多的信息，但状态的数量也会随之增加，并且实现的时候要自己手写位运算，较为复杂，本文不会涉及。</p><h2 id="信息的表示">信息的表示</h2><h3 id="luogu7076-csp-s2020-动物园">luogu7076 [CSP-S2020] 动物园</h3><p>题意比较绕。</p><p>一个 <span class="math inline">\((p_i,q_i)\)</span> 相当于对二进制中第 <span class="math inline">\(p_i\)</span> 位进行了限制。把所有 <span class="math inline">\(p_i\)</span> 压成一个整数，如果这个数第 <span class="math inline">\(i\)</span> 位为 <span class="math inline">\(1\)</span> 并且没有 <span class="math inline">\(a_j\)</span> 满足这一位是 <span class="math inline">\(1\)</span>，那么所有编号第 <span class="math inline">\(i\)</span> 位是 <span class="math inline">\(1\)</span> 的动物就不能选。</p><p>把不能选的位压成一个整数 <span class="math inline">\(t\)</span>，那么能选的动物的编号，在所有 <span class="math inline">\(t\)</span> 中为 <span class="math inline">\(1\)</span> 的数位上都是 <span class="math inline">\(0\)</span>，答案就是 <span class="math display">\[ 2^{k-\operatorname{popcount}(t)} - n \]</span> 注意可能会爆<code>unsigned long long</code>。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> uint unsigned long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PII pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MP make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pb push_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> eb emplace_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SET(a,b) memset(a,b,sizeof(a))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CPY(a,b) memcpy(a,b,sizeof(b))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);++i)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> per(i,j,k) for(int i=(j);i&gt;=(k);--i)</span><br><span class="hljs-function">uint <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	uint a=<span class="hljs-number">0</span>; <span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(c)) &#123;<br>		c=<span class="hljs-built_in">getchar</span>();<br>	&#125;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(c)) a=a*<span class="hljs-number">10</span>+c-<span class="hljs-string">&#x27;0&#x27;</span>, c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> a;<br>&#125;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e6</span>+<span class="hljs-number">5</span>;<br>uint n, m, c, k, a[N], p[N], q[N];<br>uint h[<span class="hljs-number">70</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(uint x)</span> </span>&#123;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=k<span class="hljs-number">-1</span>;~i;--i) <span class="hljs-keyword">if</span>(x&amp;(<span class="hljs-number">1ull</span>&lt;&lt;i)) ++h[i];<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">popcount</span><span class="hljs-params">(uint x)</span> </span>&#123;<br>	<span class="hljs-type">int</span> cnt=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">while</span>(x) cnt+=x&amp;<span class="hljs-number">1</span>, x&gt;&gt;=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">return</span> cnt;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>(), c=<span class="hljs-built_in">read</span>(), k=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,n) &#123;<br>		a[i]=<span class="hljs-built_in">read</span>();<br>		<span class="hljs-built_in">add</span>(a[i]);<br>	&#125;<br>	uint cc=<span class="hljs-number">0</span>;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,m) &#123;<br>		p[i]=<span class="hljs-built_in">read</span>(), q[i]=<span class="hljs-built_in">read</span>();<br>		cc|=(<span class="hljs-number">1ull</span>&lt;&lt;p[i]);<br>	&#125;<br>	uint ng=<span class="hljs-number">0</span>;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,k<span class="hljs-number">-1</span>) &#123;<br>		<span class="hljs-keyword">if</span>(h[i]==<span class="hljs-number">0</span>&amp;&amp;cc&amp;(<span class="hljs-number">1ull</span>&lt;&lt;i)) ng|=(<span class="hljs-number">1ull</span>&lt;&lt;i);<br>	&#125;<br>	<span class="hljs-type">int</span> cnt=<span class="hljs-built_in">popcount</span>(ng);<br>	<span class="hljs-keyword">if</span>(k==<span class="hljs-number">0</span>) <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;1&quot;</span>);<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(k!=<span class="hljs-number">64</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%llu\n&quot;</span>,(<span class="hljs-number">1ull</span>&lt;&lt;(k-cnt))-n);<br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-keyword">if</span>(cnt!=<span class="hljs-number">0</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%llu\n&quot;</span>,(<span class="hljs-number">1ull</span>&lt;&lt;(k-cnt))-n);<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(n!=<span class="hljs-number">0</span>) &#123;<br>			<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%llu\n&quot;</span>,<span class="hljs-number">0</span>-n);<br>		&#125; <span class="hljs-keyword">else</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;18446744073709551616&quot;</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="luogu1357-花园">luogu1357 花园</h3><p>把<code>P</code>看作 <span class="math inline">\(0\)</span>，<code>C</code>看作 <span class="math inline">\(1\)</span>，然后把 <span class="math inline">\(m\)</span> 个花圃的状态压成一个整数。</p><p>同时值域不大，可以用 <span class="math inline">\(\text{DFS}\)</span> 搜出所有合法状态。</p><p>断环为链，则环等价于序列 <span class="math inline">\([1,n+m]\)</span>，同时要求 <span class="math inline">\([1,n]\)</span> 与 <span class="math inline">\([n,n+m-1]\)</span> 相同。任意相邻 <span class="math inline">\(m\)</span> 个花圃不同，可以看作是在一个合法状态上删掉前面一位，加上后面一位，这样向前推进 <span class="math inline">\(n\)</span> 次。于是在上一步处理合法状态时，顺便处理状态之间的这样的转移。</p><p>这里用到一个 Trick，对于这种环上状态压缩，可以用处理序列的方法做，最后让开头和结尾相同即可。</p><p><span class="math inline">\(n\)</span> 很大，状态数很少且满足结合律，可以使用矩阵加速。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Problem: P1357 花园</span><br><span class="hljs-comment">// Contest: Luogu</span><br><span class="hljs-comment">// URL: https://www.luogu.com.cn/problem/P1357</span><br><span class="hljs-comment">// Author: KisaragiQwQ</span><br><span class="hljs-comment">// Date: 2023-06-19 16:15:49</span><br><span class="hljs-comment">// Memory Limit: 125 MB</span><br><span class="hljs-comment">// Time Limit: 1000 ms</span><br><span class="hljs-comment">// </span><br><span class="hljs-comment">// Let&#x27;s Daze</span><br><span class="hljs-comment">// </span><br><span class="hljs-comment">// Powered by CP Editor (https://cpeditor.org)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> uint unsigned long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PII pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MP make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pb push_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> eb emplace_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SET(a,b) memset(a,b,sizeof(a))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CPY(a,b) memcpy(a,b,sizeof(b))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);++i)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> per(i,j,k) for(int i=(j);i&gt;=(k);--i)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-type">int</span> a=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(c)) &#123;<br>		<span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;<br>		c=<span class="hljs-built_in">getchar</span>();<br>	&#125;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(c)) a=a*<span class="hljs-number">10</span>+c-<span class="hljs-string">&#x27;0&#x27;</span>, c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> a*f;<br>&#125;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">1e9</span>+<span class="hljs-number">7</span>;<br><span class="hljs-type">int</span> n, m, k, U, ok[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">5</span>];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Mat</span> &#123;<br>	<span class="hljs-type">int</span> m[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">5</span>][<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">5</span>];<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-built_in">SET</span>(m,<span class="hljs-number">0</span>); &#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">id</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,U) m[i][i]=<span class="hljs-number">1</span>; &#125;<br>&#125; a, c;<br>Mat <span class="hljs-keyword">operator</span>*(Mat a,Mat b) &#123;<br>	Mat c; c.<span class="hljs-built_in">clear</span>();<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=U;++i)<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">0</span>;k&lt;=U;++k)<br>			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;=U;++j)<br>				(c.m[i][j]+=a.m[i][k]*b.m[k][j]%mod)%=mod;<br>	<span class="hljs-keyword">return</span> c;<br>&#125;<br><span class="hljs-function">Mat <span class="hljs-title">fp</span><span class="hljs-params">(Mat a,<span class="hljs-type">int</span> b)</span> </span>&#123;<br>	Mat c; c.<span class="hljs-built_in">clear</span>(), c.<span class="hljs-built_in">id</span>();<br>	<span class="hljs-keyword">for</span>(;b;a=a*a,b&gt;&gt;=<span class="hljs-number">1</span>) <span class="hljs-keyword">if</span>(b&amp;<span class="hljs-number">1</span>) c=c*a;<br>	<span class="hljs-keyword">return</span> c;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">nbuna</span><span class="hljs-params">(<span class="hljs-type">int</span> j,<span class="hljs-type">int</span> S)</span> </span>&#123;<br>	ok[S]=<span class="hljs-number">1</span>;<br>	<span class="hljs-type">int</span> S0=S&gt;&gt;<span class="hljs-number">1</span>;<br>	a.m[S0][S]=<span class="hljs-number">1</span>;<br>    <span class="hljs-comment">// S0是去掉第一位，最后一位不放1</span><br>	<span class="hljs-keyword">if</span>(j==k&amp;&amp;(S&amp;<span class="hljs-number">1</span>)==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-comment">// 如果已经放满k个1并且去掉的第一位不是1，说明还有k个1</span><br>	a.m[S0|(<span class="hljs-number">1</span>&lt;&lt;(m<span class="hljs-number">-1</span>))][S]=<span class="hljs-number">1</span>;<br>    <span class="hljs-comment">// 这里是最后一位放1</span><br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> i,<span class="hljs-type">int</span> j,<span class="hljs-type">int</span> S)</span> </span>&#123;<br>	<span class="hljs-keyword">if</span>(i==m) &#123; <span class="hljs-built_in">nbuna</span>(j,S); <span class="hljs-keyword">return</span>; &#125;<br>	<span class="hljs-built_in">dfs</span>(i+<span class="hljs-number">1</span>,j,S);<br>	<span class="hljs-keyword">if</span>(j&lt;k) <span class="hljs-built_in">dfs</span>(i+<span class="hljs-number">1</span>,j+<span class="hljs-number">1</span>,S|(<span class="hljs-number">1</span>&lt;&lt;i));<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>(), k=<span class="hljs-built_in">read</span>();<br>	U=(<span class="hljs-number">1</span>&lt;&lt;m)<span class="hljs-number">-1</span>;<br>	<span class="hljs-built_in">dfs</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>	c=<span class="hljs-built_in">fp</span>(a,n);<br>	<span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,U) <span class="hljs-keyword">if</span>(ok[i]) (ans+=c.m[i][i])%=mod;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>,ans);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="arc058e-和風いろはちゃん">ARC058E 和風いろはちゃん</h3><p>注意到只有和为 <span class="math inline">\(X+Y+Z\)</span> 的那一段才有用，这一段的方案数可以直接插板出来。但是没什么用，因为如果把这一段与其他部分分开做，就会产生重复。</p><p>我们考虑 <span class="math inline">\(DP\)</span>。</p><p>直观上本题的非法方案要比合法方案更好求，这里选择求非法方案数。</p><div class="note note-success"><p>事实上，求出合法方案也并不困难，不过为了去重，需要在第一次满足条件时统计贡献。</p></div><p>注意到 <span class="math inline">\(X+Y+Z\)</span> 很小，我们希望有一种方式能够让我们知道一个位置总和恰好为 <span class="math inline">\(X+Y+Z\)</span> 若干位置，是否能划分成合法的三段。</p><p>考虑把这个看成一个二进制数。二进制数中，每个 <span class="math inline">\(1\)</span> 代表一个元素，这个元素的值就是 <span class="math inline">\(1\)</span> 加上它与下一个 <span class="math inline">\(1\)</span> 之间 <span class="math inline">\(0\)</span> 的个数，也就是说 <span class="math inline">\(x\)</span> 被表示为 <span class="math inline">\(2^{x-1}\)</span>。这样任何和为 <span class="math inline">\(X+Y+Z\)</span> 的情况，我们都能用一个二进制数表示，并且它的上界是 <span class="math inline">\(17\)</span> 个 <span class="math inline">\(1\)</span>，也就是 <span class="math inline">\(2^{18}-1\)</span>。</p><p>设 <span class="math inline">\(f(i,S)\)</span> 为考虑了前 <span class="math inline">\(i\)</span> 位，其中 <span class="math inline">\(i\)</span> 前面和为 <span class="math inline">\(X+Y+Z\)</span> 的一段的情况为 <span class="math inline">\(S\)</span> 的方案数。</p><p>转移枚举下一个元素填什么，并且更新 <span class="math inline">\(S\)</span> 即可，细节见代码。注意任何时候 <span class="math inline">\(S\)</span> 都不能被分成合法的三段。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> uint unsigned long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PII pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MP make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pb push_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> eb emplace_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SET(a,b) memset(a,b,sizeof(a))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CPY(a,b) memcpy(a,b,sizeof(b))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);++i)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> per(i,j,k) for(int i=(j);i&gt;=(k);--i)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-type">int</span> a=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(c)) &#123;<br>		<span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;<br>		c=<span class="hljs-built_in">getchar</span>();<br>	&#125;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(c)) a=a*<span class="hljs-number">10</span>+c-<span class="hljs-string">&#x27;0&#x27;</span>, c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> a*f;<br>&#125;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">42</span>, M=<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">18</span>, mod=<span class="hljs-number">1e9</span>+<span class="hljs-number">7</span>;<br><span class="hljs-type">int</span> n, X, Y, Z;<br><span class="hljs-type">int</span> U, f[N][M];<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">valid</span><span class="hljs-params">(<span class="hljs-type">int</span> S)</span> </span>&#123;<br>	<span class="hljs-type">int</span> k1=(S&gt;&gt;(Z<span class="hljs-number">-1</span>))&amp;<span class="hljs-number">1</span>;<br>	<span class="hljs-type">int</span> k2=(S&gt;&gt;(Y+Z<span class="hljs-number">-1</span>))&amp;<span class="hljs-number">1</span>;<br>	<span class="hljs-type">int</span> k3=(S&gt;&gt;(X+Y+Z<span class="hljs-number">-1</span>))&amp;<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">if</span>(k1&amp;&amp;k2&amp;&amp;k3) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// 当三者均为1时，就能划分出X+Y+Z</span><br>	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">fp</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span> </span>&#123;<br>	<span class="hljs-type">int</span> c=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">for</span>(;b;a=a*a%mod,b&gt;&gt;=<span class="hljs-number">1</span>) <span class="hljs-keyword">if</span>(b&amp;<span class="hljs-number">1</span>) c=c*a%mod;<br>	<span class="hljs-keyword">return</span> c;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	n=<span class="hljs-built_in">read</span>(), X=<span class="hljs-built_in">read</span>(), Y=<span class="hljs-built_in">read</span>(), Z=<span class="hljs-built_in">read</span>();<br>	U=(<span class="hljs-number">1</span>&lt;&lt;(X+Y+Z))<span class="hljs-number">-1</span>;<br>	f[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]=<span class="hljs-number">1</span>;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,n) <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S=<span class="hljs-number">0</span>;S&lt;=U;++S) &#123;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=<span class="hljs-number">10</span>;++j) &#123;<br>			<span class="hljs-type">int</span> T=((S&lt;&lt;j)+(<span class="hljs-number">1</span>&lt;&lt;(j<span class="hljs-number">-1</span>)))&amp;U;<br>            <span class="hljs-comment">//扔掉后面的j位，加上当前值</span><br>			<span class="hljs-keyword">if</span>(<span class="hljs-built_in">valid</span>(T)) (f[i][T]+=f[i<span class="hljs-number">-1</span>][S])%=mod;<br>		&#125;<br>	&#125;<br>	<span class="hljs-type">int</span> ans=<span class="hljs-built_in">fp</span>(<span class="hljs-number">10</span>,n);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S=<span class="hljs-number">0</span>;S&lt;=U;++S) (ans-=f[n][S]-mod)%=mod;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>,ans);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="状压-dp">状压 DP</h2><p>状态压缩使得状态可以度量，从而便于对复杂状态进行 DP。</p><p>有一个 Trick，名叫按秩转移。本质上是根据集合的无序性钦定基准点，从而减少不必要的状态数。基准点一般选取 <span class="math inline">\(\operatorname{lowbit}(S)\)</span>。</p><p>在下面的题目中会有所涉及。</p><h3 id="luogu3959-noip2017-提高组-宝藏">luogu3959 [NOIP2017 提高组] 宝藏</h3><p>太经典了。</p><p>打通的一定是一棵生成树，不难想到对生成树树高进行状压。</p><p>设 <span class="math inline">\(f(x,S)\)</span> 为当前树高为 <span class="math inline">\(x\)</span>，已经打通的节点集合为 <span class="math inline">\(S\)</span> 的最小代价。</p><p><span class="math display">\[ f(x,S) = \min_{S_0 \subseteq S }\Big\{ f(x-1,S_0) + x \times d(S \setminus S_0,S_0) \Big\} \]</span></p><p>其中 <span class="math inline">\(d(S,S_0)\)</span> 表示已经打通 <span class="math inline">\(S\)</span> 中节点后，打通 <span class="math inline">\(S_0\)</span> 中节点的最小代价。</p><p>本题的瓶颈在于预处理 <span class="math inline">\(d\)</span>。</p><p>朴素的做法是枚举集合 <span class="math inline">\(S\)</span> 以及 <span class="math inline">\(U-S\)</span> 的子集 <span class="math inline">\(T\)</span>，然后 <span class="math inline">\(O(n^2)\)</span> 算出从 <span class="math inline">\(S\)</span> 中任意节点到达 <span class="math inline">\(T\)</span> 中每个节点的最小代价，它们的和就是 <span class="math inline">\(d(S,T)\)</span>。复杂度 <span class="math inline">\(O(n^2 2^n)\)</span>。</p><p>使用上述技巧按秩转移。在计算 <span class="math inline">\(d(S,T)\)</span> 时，我们已经算完了 <span class="math inline">\(d\Big(S,T-\operatorname{lowbit}(T)\Big)\)</span>，所以只需要额外对 <span class="math inline">\(\operatorname{lowbit}(T)\)</span> 求一遍最小值即可。复杂度 <span class="math inline">\(O(n 2^n)\)</span>。</p><p>然而我们常用的枚举子集的代码，子集是从大到小枚举的。因此可以先存下来再从小到大求。</p><p>使用 <span class="math inline">\(\text{DFS}\)</span> 转移这个状态会跑得很快，不再赘述。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ll long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> uint unsigned long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PII pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MP make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pb push_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> eb emplace_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SET(a,b) memset(a,b,sizeof(a))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CPY(a,b) memcpy(a,b,sizeof(b))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);++i)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> per(i,j,k) for(int i=(j);i&gt;=(k);--i)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-type">int</span> a=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(c)) &#123;<br>		<span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;<br>		c=<span class="hljs-built_in">getchar</span>();<br>	&#125;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(c)) a=a*<span class="hljs-number">10</span>+c-<span class="hljs-string">&#x27;0&#x27;</span>, c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> a*f;<br>&#125;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">15</span>, inf=<span class="hljs-number">0x3f3f3f3f</span>;<br><span class="hljs-type">int</span> n, m, U, ans=inf, dis[N][N], d[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">12</span>][<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">12</span>];<br><span class="hljs-type">int</span> f[N][<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">12</span>], nxt[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">12</span>], lg[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">12</span>];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> S)</span> </span>&#123; <span class="hljs-keyword">return</span> S&amp;-S; &#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">prework</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,n<span class="hljs-number">-1</span>) lg[<span class="hljs-number">1</span>&lt;&lt;i]=i;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S=<span class="hljs-number">1</span>;S&lt;=U;++S) &#123;<br>		<span class="hljs-type">int</span> T=U^S, cnt=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S0=T;S0;S0=(S0<span class="hljs-number">-1</span>)&amp;T) nxt[S0]=cnt, cnt=S0;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S0=cnt;S0;S0=nxt[S0]) &#123;<br>			<span class="hljs-type">int</span> x=lg[<span class="hljs-built_in">lowbit</span>(S0)], t=inf;<br>			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> y=<span class="hljs-number">0</span>;y&lt;n;++y) <span class="hljs-keyword">if</span>(S&amp;(<span class="hljs-number">1</span>&lt;&lt;y)) t=<span class="hljs-built_in">min</span>(t,dis[x][y]);<br>			<span class="hljs-type">int</span> pre=d[S][S0^<span class="hljs-built_in">lowbit</span>(S0)];<br>			<span class="hljs-keyword">if</span>(t!=inf&amp;&amp;pre!=inf) d[S][S0]=pre+t;<br>			<span class="hljs-keyword">else</span> d[S][S0]=inf;<br>		&#125;<br>	&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-built_in">SET</span>(dis,<span class="hljs-number">0x3f</span>);<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,m) &#123;<br>		<span class="hljs-type">int</span> x=<span class="hljs-built_in">read</span>()<span class="hljs-number">-1</span>, y=<span class="hljs-built_in">read</span>()<span class="hljs-number">-1</span>, z=<span class="hljs-built_in">read</span>();<br>		dis[x][y]=dis[y][x]=<span class="hljs-built_in">min</span>(dis[x][y],z);<br>	&#125;<br>	U=(<span class="hljs-number">1</span>&lt;&lt;n)<span class="hljs-number">-1</span>;<br>	<span class="hljs-built_in">prework</span>();<br>	<span class="hljs-built_in">SET</span>(f,<span class="hljs-number">0x3f</span>);<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,n<span class="hljs-number">-1</span>) f[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>&lt;&lt;i]=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;n;++i) &#123;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S=<span class="hljs-number">1</span>;S&lt;=U;++S) &#123;<br>			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> T=S;T;T=(T<span class="hljs-number">-1</span>)&amp;S) <span class="hljs-keyword">if</span>(d[S^T][T]!=inf) f[i][S]=<span class="hljs-built_in">min</span>(f[i][S],f[i<span class="hljs-number">-1</span>][S^T]+i*d[S^T][T]);<br>		&#125;<br>	&#125;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,n) ans=<span class="hljs-built_in">min</span>(ans,f[i][U]);<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>,ans);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="cf11d-a-simple-task">CF11D A Simple Task</h3><p>典题。</p><p>设 <span class="math inline">\(f(x,y,S)\)</span> 为只经过点集 <span class="math inline">\(S\)</span> 中的点，<span class="math inline">\(x\)</span> 到 <span class="math inline">\(y\)</span> 有多少路径，转移枚举中间点。</p><p>然而有很多环被重复统计了多次，而且数组开不下。</p><p>按秩转移。考虑让 <span class="math inline">\(y=\operatorname{lowbit}(S)\)</span> 作为基准点，这样状态就成了 <span class="math inline">\(f(x,S)\)</span>，规模可以承受。</p><p>对于一个 <span class="math inline">\(f(x,S)\)</span>，枚举 <span class="math inline">\((x \rightarrow y)\)</span>，当 <span class="math inline">\(y=\operatorname{lowbit}(S)\)</span> 说明找到了环，计入答案。否则只在 <span class="math inline">\(y\)</span> 可能作为 <span class="math inline">\(S\)</span> 后继状态的基准点，也就是 <span class="math inline">\(2^y \ge \operatorname{lowbit}(S)\)</span> 时转移到 <span class="math inline">\(f(x,S \cup \{j\})\)</span>。</p><p>复杂度 <span class="math inline">\(O(n^2 2^n)\)</span>。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-number">3092</span> [USACO13NOV] No Change G<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> uint unsigned long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PII pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MP make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pb push_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> eb emplace_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SET(a,b) memset(a,b,sizeof(a))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CPY(a,b) memcpy(a,b,sizeof(b))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);++i)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> per(i,j,k) for(int i=(j);i&gt;=(k);--i)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-type">int</span> a=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(c)) &#123;<br>		<span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;<br>		c=<span class="hljs-built_in">getchar</span>();<br>	&#125;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(c)) a=a*<span class="hljs-number">10</span>+c-<span class="hljs-string">&#x27;0&#x27;</span>, c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> a*f;<br>&#125;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">25</span>;<br><span class="hljs-type">int</span> n, m, U, ans, a[N][N], f[N][<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">19</span>];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> S)</span> </span>&#123; <span class="hljs-keyword">return</span> S&amp;-S; &#125;;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>();<br>	U=(<span class="hljs-number">1</span>&lt;&lt;n)<span class="hljs-number">-1</span>;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,m) &#123;<br>		<span class="hljs-type">int</span> x=<span class="hljs-built_in">read</span>()<span class="hljs-number">-1</span>, y=<span class="hljs-built_in">read</span>()<span class="hljs-number">-1</span>;<br>		a[x][y]=a[y][x]=<span class="hljs-number">1</span>;<br>	&#125;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,n<span class="hljs-number">-1</span>) f[i][<span class="hljs-number">1</span>&lt;&lt;i]=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S=<span class="hljs-number">1</span>;S&lt;=U;++S) &#123;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;++i) <span class="hljs-keyword">if</span>(S&amp;(<span class="hljs-number">1</span>&lt;&lt;i)) &#123;<br>			<span class="hljs-keyword">if</span>(!f[i][S]) <span class="hljs-keyword">continue</span>;<br>			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;n;++j) <span class="hljs-keyword">if</span>(a[i][j]) &#123;<br>				<span class="hljs-keyword">if</span>((<span class="hljs-number">1</span>&lt;&lt;j)&lt;<span class="hljs-built_in">lowbit</span>(S)) <span class="hljs-keyword">continue</span>;<br>				<span class="hljs-keyword">if</span>((<span class="hljs-number">1</span>&lt;&lt;j)==<span class="hljs-built_in">lowbit</span>(S)) ans+=f[i][S];<br>				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((S&amp;(<span class="hljs-number">1</span>&lt;&lt;j))==<span class="hljs-number">0</span>) f[j][S|(<span class="hljs-number">1</span>&lt;&lt;j)]+=f[i][S];<br>			&#125;<br>		&#125;<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>,(ans-m)&gt;&gt;<span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="luogu3092-usaco13nov-no-change-g">luogu3092 [USACO13NOV] No Change G</h3><p>看得出来是一个区间划分类题目。</p><p>设 <span class="math inline">\(f(S)\)</span> 为集合 <span class="math inline">\(S\)</span> 内的硬币能够买到的最多物品。这个和顺序有关，转移时枚举最后一个使用的硬币，二分即可。</p><p>设 <span class="math inline">\(g(S)\)</span> 为在能买下所有物品的情况下，集合 <span class="math inline">\(S\)</span> 内硬币的总价值。</p><p>枚举没有使用的硬币集合 <span class="math inline">\(S\)</span>，如果 <span class="math inline">\(f(U \setminus S)=n\)</span>，那么就从 <span class="math inline">\(\operatorname{lowbit}\)</span> 处更新 <span class="math inline">\(g(S)\)</span>，同时更新答案。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> uint unsigned long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PII pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MP make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pb push_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> eb emplace_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SET(a,b) memset(a,b,sizeof(a))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CPY(a,b) memcpy(a,b,sizeof(b))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);++i)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> per(i,j,k) for(int i=(j);i&gt;=(k);--i)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-type">int</span> a=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(c)) &#123;<br>		<span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;<br>		c=<span class="hljs-built_in">getchar</span>();<br>	&#125;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(c)) a=a*<span class="hljs-number">10</span>+c-<span class="hljs-string">&#x27;0&#x27;</span>, c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> a*f;<br>&#125;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">20</span>, M=<span class="hljs-number">1e5</span>+<span class="hljs-number">5</span>;<br><span class="hljs-type">int</span> k, n, U, ans=<span class="hljs-number">-1</span>, c[N], s[M], f[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">16</span>], g[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">16</span>], lg[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">16</span>];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">bs</span><span class="hljs-params">(<span class="hljs-type">int</span> L,<span class="hljs-type">int</span> x)</span> </span>&#123;<br>	<span class="hljs-type">int</span> l=L, r=n;<br>	<span class="hljs-keyword">while</span>(l&lt;r) &#123;<br>		<span class="hljs-type">int</span> mid=(l+r+<span class="hljs-number">1</span>)&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span>(s[mid]-s[L<span class="hljs-number">-1</span>]&lt;=x) l=mid; <span class="hljs-keyword">else</span> r=mid<span class="hljs-number">-1</span>;<br>	&#125;<br>	<span class="hljs-keyword">return</span> l;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>&#123; <span class="hljs-keyword">return</span> x&amp;-x; &#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	k=<span class="hljs-built_in">read</span>(), n=<span class="hljs-built_in">read</span>();<br>	U=(<span class="hljs-number">1</span>&lt;&lt;k)<span class="hljs-number">-1</span>;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,k<span class="hljs-number">-1</span>) c[i]=<span class="hljs-built_in">read</span>(), lg[<span class="hljs-number">1</span>&lt;&lt;i]=i;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,n) s[i]=s[i<span class="hljs-number">-1</span>]+<span class="hljs-built_in">read</span>();<br>	<span class="hljs-built_in">rep</span>(S,<span class="hljs-number">1</span>,U) <span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,k<span class="hljs-number">-1</span>) <span class="hljs-keyword">if</span>(S&amp;(<span class="hljs-number">1</span>&lt;&lt;i)) &#123;<br>		<span class="hljs-keyword">if</span>(f[S^(<span class="hljs-number">1</span>&lt;&lt;i)]==n) &#123; f[S]=n; <span class="hljs-keyword">break</span>; &#125;<br>		f[S]=<span class="hljs-built_in">max</span>(f[S],<span class="hljs-built_in">bs</span>(f[S^(<span class="hljs-number">1</span>&lt;&lt;i)]+<span class="hljs-number">1</span>,c[i]));<br>	&#125;<br>	<span class="hljs-keyword">if</span>(f[U]==n) ans=<span class="hljs-built_in">max</span>(ans,<span class="hljs-number">0ll</span>);<br>	<span class="hljs-built_in">rep</span>(T,<span class="hljs-number">1</span>,U) &#123;<br>		<span class="hljs-keyword">if</span>(f[U^T]==n) ans=<span class="hljs-built_in">max</span>(ans,g[T]=g[T^<span class="hljs-built_in">lowbit</span>(T)]+c[lg[<span class="hljs-built_in">lowbit</span>(T)]]);<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>,ans);<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="luogu3694-邦邦的大合唱站队">luogu3694 邦邦的大合唱站队</h3><p>这题题面写得真的无语。</p><p>稍微转化一下，把所有乐队归队就是一个划分区间问题。如果一个乐队归队的区间确定了，那么这个区间里面的偶像就不用动，剩下的就一定要出列。</p><p>设 <span class="math inline">\(f(S)\)</span> 为把集合 <span class="math inline">\(S\)</span> 内的的乐队归队，所需要的最小代价。设 <span class="math inline">\(p_i\)</span> 为第 <span class="math inline">\(i\)</span> 个乐队的人数。</p><p>枚举最后一个归队的乐队 <span class="math inline">\(i\)</span>，算出剩下的乐队一共排到了 <span class="math inline">\(cnt\)</span> ，这样让 <span class="math inline">\(i\)</span> 归队的代价就是 <span class="math inline">\(p_i\)</span> 减去在 <span class="math inline">\([cnt+1,cnt+p_i]\)</span> 里这个乐队的偶像的数量。</p><p>前缀和预处理即可。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> uint unsigned long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PII pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MP make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pb push_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> eb emplace_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SET(a,b) memset(a,b,sizeof(a))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CPY(a,b) memcpy(a,b,sizeof(b))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);++i)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> per(i,j,k) for(int i=(j);i&gt;=(k);--i)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-type">int</span> a=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(c)) &#123;<br>		<span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;<br>		c=<span class="hljs-built_in">getchar</span>();<br>	&#125;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(c)) a=a*<span class="hljs-number">10</span>+c-<span class="hljs-string">&#x27;0&#x27;</span>, c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> a*f;<br>&#125;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">25</span>, M=<span class="hljs-number">1e5</span>+<span class="hljs-number">5</span>;<br><span class="hljs-type">int</span> n, m, U, a[M], p[N], s[N][M], f[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>];<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>();<br>	U=(<span class="hljs-number">1</span>&lt;&lt;m)<span class="hljs-number">-1</span>;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,n) &#123;<br>		a[i]=<span class="hljs-built_in">read</span>()<span class="hljs-number">-1</span>;<br>		++p[a[i]], ++s[a[i]][i];<br>	&#125;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,m<span class="hljs-number">-1</span>) <span class="hljs-built_in">rep</span>(j,<span class="hljs-number">1</span>,n) s[i][j]+=s[i][j<span class="hljs-number">-1</span>];<br>	<span class="hljs-built_in">SET</span>(f,<span class="hljs-number">0x3f</span>);<br>	f[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S=<span class="hljs-number">0</span>;S&lt;U;++S) &#123;<br>		<span class="hljs-type">int</span> cnt=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;m;++i) <span class="hljs-keyword">if</span>(S&amp;(<span class="hljs-number">1</span>&lt;&lt;i)) cnt+=p[i];<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;m;++i) &#123;<br>			<span class="hljs-keyword">if</span>(S&amp;(<span class="hljs-number">1</span>&lt;&lt;i)) <span class="hljs-keyword">continue</span>;<br>			f[S|(<span class="hljs-number">1</span>&lt;&lt;i)]=<span class="hljs-built_in">min</span>(f[S|(<span class="hljs-number">1</span>&lt;&lt;i)],f[S]+p[i]-(s[i][cnt+p[i]]-s[i][cnt]));<br>		&#125;<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>,f[U]);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="luogu2831-noip2016-提高组-愤怒的小鸟">luogu2831 [NOIP2016 提高组] 愤怒的小鸟</h3><p>很无序，很状压。</p><p>设 <span class="math inline">\(f(S)\)</span> 表示把集合 <span class="math inline">\(S\)</span> 内的都干掉的最小代价。</p><p>转移枚举最后一个被干掉的，看它能不能和某一个一起被干掉，不能的话就自己来一发。</p><p>然后这个是 <span class="math inline">\(O(n^2 2^n)\)</span>。</p><p>还是把 <span class="math inline">\(\operatorname{lowbit}(S)\)</span> 当作最后一个被干掉的，这样就做到 <span class="math inline">\(O(n 2^n)\)</span>。</p><p>为了方便，预处理 <span class="math inline">\(p(i,j)\)</span> 表示 <span class="math inline">\(i\)</span> 和 <span class="math inline">\(j\)</span> 确定的抛物线能干掉的集合。</p><p>需要解方程，式子比较好推，不再赘述。</p><p>还有就是注意精度问题。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Problem: P2831 [NOIP2016 提高组] 愤怒的小鸟</span><br><span class="hljs-comment">// Author: KisaragiQwQ</span><br><span class="hljs-comment">// Date: 2023-06-17 20:25:53</span><br><span class="hljs-comment">// URL: https://www.luogu.com.cn/problem/P2831</span><br><span class="hljs-comment">// Memory Limit: 500 MB</span><br><span class="hljs-comment">// Time Limit: 2000 ms</span><br><span class="hljs-comment">// </span><br><span class="hljs-comment">// Powered by CP Editor (https://cpeditor.org)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ll long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> uint unsigned long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PII pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MP make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pb push_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> eb emplace_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SET(a,b) memset(a,b,sizeof(a))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CPY(a,b) memcpy(a,b,sizeof(b))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);++i)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> per(i,j,k) for(int i=(j);i&gt;=(k);--i)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-type">int</span> a=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(c)) &#123;<br>		<span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;<br>		c=<span class="hljs-built_in">getchar</span>();<br>	&#125;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(c)) a=a*<span class="hljs-number">10</span>+c-<span class="hljs-string">&#x27;0&#x27;</span>, c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> a*f;<br>&#125;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">20</span>;<br><span class="hljs-type">const</span> <span class="hljs-type">double</span> eps=<span class="hljs-number">1e-8</span>;<br><span class="hljs-type">int</span> T, n, m, U, p[N][N], f[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">18</span>], lg[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">18</span>];<br><span class="hljs-type">double</span> x[N], y[N];<br><span class="hljs-function">pair&lt;<span class="hljs-type">double</span>,<span class="hljs-type">double</span>&gt; <span class="hljs-title">calc</span><span class="hljs-params">(<span class="hljs-type">double</span> x1,<span class="hljs-type">double</span> y1,<span class="hljs-type">double</span> x2,<span class="hljs-type">double</span> y2)</span> </span>&#123;<br>	<span class="hljs-type">double</span> a=(y1*x2-y2*x1)/(x1*x2*(x1-x2));<br>	<span class="hljs-type">double</span> b=y2/x2-x2*a;<br>	<span class="hljs-keyword">return</span> <span class="hljs-built_in">MP</span>(a,b);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">F</span><span class="hljs-params">(<span class="hljs-type">double</span> a,<span class="hljs-type">double</span> b,<span class="hljs-type">double</span> x)</span> </span>&#123; <span class="hljs-keyword">return</span> a*x*x+b*x; &#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>&#123; <span class="hljs-keyword">return</span> x&amp;-x; &#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">solve</span><span class="hljs-params">()</span> </span>&#123;<br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,n<span class="hljs-number">-1</span>) <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lf%lf&quot;</span>,&amp;x[i],&amp;y[i]);<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,n<span class="hljs-number">-1</span>) <span class="hljs-built_in">rep</span>(j,<span class="hljs-number">0</span>,n<span class="hljs-number">-1</span>) &#123;<br>		p[i][j]=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">if</span>(i==j||<span class="hljs-built_in">fabs</span>(x[i]-x[j])&lt;eps) <span class="hljs-keyword">continue</span>;<br>		pair&lt;<span class="hljs-type">double</span>,<span class="hljs-type">double</span>&gt; gen=<span class="hljs-built_in">calc</span>(x[i],y[i],x[j],y[j]);<br>		<span class="hljs-keyword">if</span>(gen.fi&gt;-eps) <span class="hljs-keyword">continue</span>;<br>		<span class="hljs-built_in">rep</span>(k,<span class="hljs-number">0</span>,n<span class="hljs-number">-1</span>) &#123;<br>			<span class="hljs-keyword">if</span>(<span class="hljs-built_in">fabs</span>(<span class="hljs-built_in">F</span>(gen.fi,gen.se,x[k])-y[k])&lt;eps) p[i][j]|=(<span class="hljs-number">1</span>&lt;&lt;k);<br>		&#125;<br>	&#125;<br>	<span class="hljs-built_in">SET</span>(f,<span class="hljs-number">0x3f</span>);<br>	f[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>;<br>	U=(<span class="hljs-number">1</span>&lt;&lt;n)<span class="hljs-number">-1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S=<span class="hljs-number">1</span>;S&lt;=U;++S) &#123;<br>		<span class="hljs-type">int</span> k=lg[<span class="hljs-built_in">lowbit</span>(S)], S0=S^(<span class="hljs-number">1</span>&lt;&lt;k);<br>		f[S]=<span class="hljs-built_in">min</span>(f[S],f[S0]+<span class="hljs-number">1</span>);<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;++i) <span class="hljs-keyword">if</span>(S0&amp;p[k][i]) f[S]=<span class="hljs-built_in">min</span>(f[S],f[S0^(S0&amp;p[k][i])]+<span class="hljs-number">1</span>);<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>,f[U]);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	T=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,<span class="hljs-number">17</span>) lg[<span class="hljs-number">1</span>&lt;&lt;i]=i;<br>	<span class="hljs-keyword">while</span>(T--) <span class="hljs-built_in">solve</span>();<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="luogu7098-yloi2020-凉凉">luogu7098 [yLOI2020] 凉凉</h3><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/blog/yozora0908/solution-p7098">link</a></p><h3 id="luogu4923-mtoi2018-gcd人生赢家">luogu4923 [MtOI2018] gcd？人生赢家！</h3><p>乍一看挺复杂的，读入尤其恶心。</p><p>直接设 <span class="math inline">\(f(x,k,S)\)</span> 为当前在宝物 <span class="math inline">\(x\)</span> 所在的节点，还剩下 <span class="math inline">\(k\)</span> 次传送机会，取得了集合 <span class="math inline">\(S\)</span> 内宝物的最小时间。</p><p>仔细想想发现还剩下 <span class="math inline">\(k\)</span> 次传送机会不太好弄，可以改为已经传送了 <span class="math inline">\(k\)</span> 次。</p><p>先算出当前已经完成了的成就，然后再枚举下一个要到达的宝物所在点，传送或者直接过去，距离用 <span class="math inline">\(\text{Floyd}\)</span> 算法处理。</p><p>用 <span class="math inline">\(\text{DFS}\)</span> 转移，跑得很快。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ll long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> uint unsigned long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PII pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MP make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pb push_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> eb emplace_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SET(a,b) memset(a,b,sizeof(a))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CPY(a,b) memcpy(a,b,sizeof(b))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);++i)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> per(i,j,k) for(int i=(j);i&gt;=(k);--i)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-type">int</span> a=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(c)) &#123;<br>		<span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;<br>		c=<span class="hljs-built_in">getchar</span>();<br>	&#125;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(c)) a=a*<span class="hljs-number">10</span>+c-<span class="hljs-string">&#x27;0&#x27;</span>, c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> a*f;<br>&#125;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">15</span>, inf=<span class="hljs-number">0x3f3f3f3f</span>;<br><span class="hljs-type">int</span> n, m, _k, s, e, U, st;<br><span class="hljs-type">int</span> ss[N], a[N], p[N], pre[N], d[<span class="hljs-number">205</span>][<span class="hljs-number">205</span>];<br><span class="hljs-type">int</span> lg[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">12</span>], f[N][N][<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">12</span>];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">popcount</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>&#123;<br>	<span class="hljs-type">int</span> cnt=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">while</span>(x) cnt+=x&amp;<span class="hljs-number">1</span>, x&gt;&gt;=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">return</span> cnt;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">input</span><span class="hljs-params">()</span> </span>&#123;<br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>(), _k=<span class="hljs-built_in">read</span>(), s=<span class="hljs-built_in">read</span>();<br>	U=(<span class="hljs-number">1</span>&lt;&lt;m)<span class="hljs-number">-1</span>;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,n) <span class="hljs-built_in">memset</span>(d[i],<span class="hljs-number">0x3f</span>,(n+<span class="hljs-number">1</span>)&lt;&lt;<span class="hljs-number">2</span>), d[i][i]=<span class="hljs-number">0</span>;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,s) &#123;<br>		<span class="hljs-type">int</span> num=<span class="hljs-built_in">read</span>();<br>		<span class="hljs-keyword">while</span>(num--) &#123;<br>			<span class="hljs-type">int</span> x=<span class="hljs-built_in">read</span>();<br>			ss[i]|=(<span class="hljs-number">1</span>&lt;&lt;(x<span class="hljs-number">-1</span>));<br>		&#125;<br>	&#125;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,s) a[i]=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,m<span class="hljs-number">-1</span>) p[i]=<span class="hljs-built_in">read</span>(), lg[<span class="hljs-number">1</span>&lt;&lt;i]=i;<br>	e=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,e) &#123;<br>		<span class="hljs-type">int</span> x=<span class="hljs-built_in">read</span>(), y=<span class="hljs-built_in">read</span>(), z=<span class="hljs-built_in">read</span>();<br>		d[x][y]=d[y][x]=<span class="hljs-built_in">min</span>(d[x][y],z);<br>	&#125;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,m<span class="hljs-number">-1</span>) &#123;<br>		<span class="hljs-type">int</span> num=<span class="hljs-built_in">read</span>();<br>		<span class="hljs-keyword">while</span>(num--) &#123;<br>			<span class="hljs-type">int</span> x=<span class="hljs-built_in">read</span>();<br>			pre[i]|=(<span class="hljs-number">1</span>&lt;&lt;(x<span class="hljs-number">-1</span>));<br>		&#125;<br>	&#125;<br>	st=<span class="hljs-built_in">read</span>();<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">floyd</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-built_in">rep</span>(k,<span class="hljs-number">1</span>,n) <span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,n) <span class="hljs-keyword">if</span>(d[i][k]!=inf) &#123;<br>		<span class="hljs-built_in">rep</span>(j,<span class="hljs-number">1</span>,n) <span class="hljs-keyword">if</span>(d[k][j]!=inf) d[i][j]=<span class="hljs-built_in">min</span>(d[i][j],d[i][k]+d[k][j]);<br>	&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>&#123; <span class="hljs-keyword">return</span> x&amp;-x; &#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> kk,<span class="hljs-type">int</span> S)</span> </span>&#123;<br>	<span class="hljs-keyword">if</span>(f[x][kk][S]!=inf) <span class="hljs-keyword">return</span> f[x][kk][S];<br>	<span class="hljs-type">int</span>&amp; res=f[x][kk][S];<br>	<span class="hljs-keyword">if</span>(S==U) <span class="hljs-keyword">return</span> res=<span class="hljs-number">0</span>;<br>	<span class="hljs-type">int</span> ayano=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=s;++i) <span class="hljs-keyword">if</span>((S&amp;ss[i])==ss[i]) ayano+=a[i];<br>	<span class="hljs-type">int</span> T=U^S;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> y=<span class="hljs-number">0</span>;y&lt;m;++y) <span class="hljs-keyword">if</span>(T&amp;(<span class="hljs-number">1</span>&lt;&lt;y)) &#123;<br>		<span class="hljs-keyword">if</span>((S&amp;pre[y])!=pre[y]) <span class="hljs-keyword">continue</span>;<br>		<span class="hljs-keyword">if</span>(d[p[x]][p[y]]!=inf) res=<span class="hljs-built_in">min</span>(res,d[p[x]][p[y]]+<span class="hljs-built_in">dfs</span>(y,kk,S|(<span class="hljs-number">1</span>&lt;&lt;y)));<br>		<span class="hljs-keyword">if</span>(kk&lt;_k+ayano) res=<span class="hljs-built_in">min</span>(res,<span class="hljs-built_in">dfs</span>(y,kk+<span class="hljs-number">1</span>,S|(<span class="hljs-number">1</span>&lt;&lt;y)));<br>	&#125;<br>	<span class="hljs-keyword">return</span> res;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-built_in">input</span>();<br>	<span class="hljs-built_in">floyd</span>();<br>	<span class="hljs-built_in">SET</span>(f,<span class="hljs-number">0x3f</span>);<br>	<span class="hljs-type">int</span> ans=inf;<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">0</span>,m<span class="hljs-number">-1</span>) <span class="hljs-keyword">if</span>(pre[i]==<span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// 起点是任意没有前置要求的宝物处。</span><br>		<span class="hljs-keyword">if</span>(d[st][p[i]]!=inf) ans=<span class="hljs-built_in">min</span>(ans,d[st][p[i]]+<span class="hljs-built_in">dfs</span>(i,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>&lt;&lt;i));<br>		<span class="hljs-keyword">if</span>(_k) ans=<span class="hljs-built_in">min</span>(ans,<span class="hljs-built_in">dfs</span>(i,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>&lt;&lt;i));<br>	&#125; <br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>,ans);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="luogu3622-apio2007-动物园">luogu3622 [APIO2007] 动物园</h3><p>有了花园那题的铺垫，这题我们直接状压后面 <span class="math inline">\(5\)</span> 个格子的状态。</p><p>可以预处理出每个状态的高兴小朋友数量。</p><p>设 <span class="math inline">\(f(i,S)\)</span> 表示考虑前 <span class="math inline">\(i\)</span> 个格子，<span class="math inline">\([i,i+4]\)</span> 的状态是 <span class="math inline">\(S\)</span> 的最大数量。</p><p>枚举初始状态 <span class="math inline">\(S&#39;\)</span>，每次往前推一位，后继状态就是最高位放不放 <span class="math inline">\(1\)</span>。</p><p>警钟敲烂，使用刷表法的时候，一定记得清空整个数组。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Problem: P3622 [APIO2007] 动物园</span><br><span class="hljs-comment">// Contest: Luogu</span><br><span class="hljs-comment">// URL: https://www.luogu.com.cn/problem/P3622</span><br><span class="hljs-comment">// Author: KisaragiQwQ</span><br><span class="hljs-comment">// Date: 2023-06-19 16:59:37</span><br><span class="hljs-comment">// Memory Limit: 125 MB</span><br><span class="hljs-comment">// Time Limit: 1000 ms</span><br><span class="hljs-comment">// </span><br><span class="hljs-comment">// Let&#x27;s Daze</span><br><span class="hljs-comment">// </span><br><span class="hljs-comment">// Powered by CP Editor (https://cpeditor.org)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ll long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> uint unsigned long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PII pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MP make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pb push_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> eb emplace_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SET(a,b) memset(a,b,sizeof(a))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CPY(a,b) memcpy(a,b,sizeof(b))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);++i)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> per(i,j,k) for(int i=(j);i&gt;=(k);--i)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-type">int</span> a=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(c)) &#123;<br>		<span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;<br>		c=<span class="hljs-built_in">getchar</span>();<br>	&#125;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(c)) a=a*<span class="hljs-number">10</span>+c-<span class="hljs-string">&#x27;0&#x27;</span>, c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> a*f;<br>&#125;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e4</span>+<span class="hljs-number">5</span>, M=<span class="hljs-number">5e4</span>+<span class="hljs-number">5</span>, U=<span class="hljs-number">31</span>;<br><span class="hljs-type">int</span> n, m, f[N][<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">5</span>], w[N][<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">5</span>];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">popcount</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>&#123;<br>    <span class="hljs-type">int</span> cnt=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(x) cnt+=x&amp;<span class="hljs-number">1</span>, x&gt;&gt;=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">return</span> cnt;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,m) &#123;<br>		<span class="hljs-type">int</span> x=<span class="hljs-built_in">read</span>(), c1=<span class="hljs-built_in">read</span>(), c2=<span class="hljs-built_in">read</span>();<br>		<span class="hljs-type">int</span> f=<span class="hljs-number">0</span>, l=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">while</span>(c1--) &#123;<br>			<span class="hljs-type">int</span> p=<span class="hljs-built_in">read</span>();<br>			p=(p-x+n)%n;<br>			f|=(<span class="hljs-number">1</span>&lt;&lt;p);<br>		&#125;<br>		<span class="hljs-keyword">while</span>(c2--) &#123;<br>			<span class="hljs-type">int</span> p=<span class="hljs-built_in">read</span>();<br>			p=(p-x+n)%n;<br>			l|=(<span class="hljs-number">1</span>&lt;&lt;p);<br>		&#125;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S=<span class="hljs-number">0</span>;S&lt;=U;++S) &#123;<br>			<span class="hljs-keyword">if</span>(S&amp;l||f&amp;(~S)) ++w[x][S];<br>		&#125;<br>	&#125;<br>	<span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=U;++i) &#123;<br>		<span class="hljs-built_in">SET</span>(f,<span class="hljs-number">-0x3f</span>);<br>        <span class="hljs-comment">// 清空整个数组</span><br>		f[<span class="hljs-number">0</span>][i]=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;n;++j) <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S=<span class="hljs-number">0</span>;S&lt;=U;++S) &#123;<br>            <span class="hljs-type">int</span> S0=S&gt;&gt;<span class="hljs-number">1</span>, S1=(S0|<span class="hljs-number">16</span>)&amp;<span class="hljs-number">31</span>;<br>            f[j+<span class="hljs-number">1</span>][S0]=<span class="hljs-built_in">max</span>(f[j+<span class="hljs-number">1</span>][S0],f[j][S]+w[j+<span class="hljs-number">1</span>][S0]);<br>			f[j+<span class="hljs-number">1</span>][S1]=<span class="hljs-built_in">max</span>(f[j+<span class="hljs-number">1</span>][S1],f[j][S]+w[j+<span class="hljs-number">1</span>][S1]);<br>		&#125;<br>		ans=<span class="hljs-built_in">max</span>(ans,f[n][i]);<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>,ans);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>填表法代码</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">SET</span>(f[<span class="hljs-number">0</span>],<span class="hljs-number">-0x3f</span>);<br>f[<span class="hljs-number">0</span>][i]=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=n;++j) <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> S=<span class="hljs-number">0</span>;S&lt;=U;++S) &#123;<br>	f[j][S]=<span class="hljs-built_in">max</span>(f[j<span class="hljs-number">-1</span>][(S&amp;<span class="hljs-number">15</span>)&lt;&lt;<span class="hljs-number">1</span>],f[j<span class="hljs-number">-1</span>][((S&amp;<span class="hljs-number">15</span>)&lt;&lt;<span class="hljs-number">1</span>)|<span class="hljs-number">1</span>])+w[j][S];<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="luogu2150-noi2015-寿司晚宴">luogu2150 [NOI2015] 寿司晚宴</h3><p>很显然是在质因子上做文章。</p><p>30 分怎么做？</p><p><span class="math inline">\(n \le 30\)</span>，质因子只有 <span class="math inline">\(10\)</span> 个，可以对其状压。设 <span class="math inline">\(f(x,S_1,S_2)\)</span> 为考虑了前 <span class="math inline">\(i\)</span> 个数，其中第一个人的质因子集合为 <span class="math inline">\(S_1\)</span>，另一个人是 <span class="math inline">\(S_2\)</span> 的方案数。预处理每个数的质因子集合，转移的时候讨论每个数的 <span class="math inline">\(3\)</span> 种情况即可。</p><p>考虑 50 分做法。设 <span class="math inline">\(f(S)\)</span> 为选出的质因子集合为 <span class="math inline">\(S\)</span> 的方案数，<span class="math inline">\(g(S) = \sum_{T \subseteq S} f(T)\)</span>，那么答案就是</p><p><span class="math display">\[ \sum_{S \subseteq U} f(S) g(U \setminus S) \]</span></p><p>然而 <span class="math inline">\(100\)</span> 以内的质数有 <span class="math inline">\(25\)</span> 个。</p><p>考虑超过 <span class="math inline">\(50\)</span> 的质因数只能出现 <span class="math inline">\(1\)</span> 次，因此可以只考虑 <span class="math inline">\(\le 50\)</span> 的 <span class="math inline">\(15\)</span> 个质数。超过 <span class="math inline">\(50\)</span> 的质数只有 <span class="math inline">\(3\)</span> 种方案，最后乘上一个 <span class="math inline">\(3\)</span> 的次幂即可。</p><p>考虑正解。</p><p><span class="math inline">\(\texttt{Observation}\)</span></p><p>超过 <span class="math inline">\(\sqrt n\)</span> 的质数最多选择 <span class="math inline">\(1\)</span> 个。</p><p>因此我们就把不超过 <span class="math inline">\(\sqrt n\)</span> 的最多 <span class="math inline">\(8\)</span> 个质数单拿出来。设超过 <span class="math inline">\(\sqrt n\)</span> 的质数为 <span class="math inline">\(\{bp\}\)</span>，不超过 <span class="math inline">\(\sqrt n\)</span> 的为 <span class="math inline">\(\{sp\}\)</span>。含相同 <span class="math inline">\(bp\)</span> 的数构成一个等价类，把不含 <span class="math inline">\(bp\)</span> 的数看作大小为 <span class="math inline">\(1\)</span> 的等价类。排序后分段处理。</p><p>设 <span class="math inline">\(f(S_1,S_2)\)</span> 为二者的质因数集合分别为 <span class="math inline">\(S_1,S_2\)</span> 的方案数，<span class="math inline">\(g_1(S_1,S_2)\)</span> 和 <span class="math inline">\(g_2(S_1,S_2)\)</span> 是在当前等价类 <span class="math inline">\(i\)</span> 中，<span class="math inline">\(bp_i\)</span> 只能放到 <span class="math inline">\(S_1\)</span> 或 <span class="math inline">\(S_2\)</span> 的方案数。注意最终没有放 <span class="math inline">\(bp_i\)</span> 的方案在二者中都能统计到。</p><p>当做完一个等价类后，令 <span class="math inline">\(g_1(S_1,S_2) + g_2(S_1,S_2) - f(S_1,S_2) \rightarrow f(S_1,S_2)\)</span>。</p><p>复杂度是 <span class="math inline">\(\mathcal{O}(n 2^{16})\)</span>。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Problem: P2150 [NOI2015] 寿司晚宴</span><br><span class="hljs-comment">// Contest: Luogu</span><br><span class="hljs-comment">// URL: https://www.luogu.com.cn/problem/P2150</span><br><span class="hljs-comment">// Author: yozora0908</span><br><span class="hljs-comment">// Date: 2023-07-15 11:13:46</span><br><span class="hljs-comment">// Memory Limit: 125 MB</span><br><span class="hljs-comment">// Time Limit: 1000 ms</span><br><span class="hljs-comment">// </span><br><span class="hljs-comment">// Let&#x27;s Daze</span><br><span class="hljs-comment">// </span><br><span class="hljs-comment">// Powered by CP Editor (https://cpeditor.org)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> uint unsigned long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PII pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MP make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pb push_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> eb emplace_back</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SET(a,b) memset(a,b,sizeof(a))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CPY(a,b) memcpy(a,b,sizeof(b))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);++i)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> per(i,j,k) for(int i=(j);i&gt;=(k);--i)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-type">int</span> a=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(c)) &#123;<br>		<span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;<br>		c=<span class="hljs-built_in">getchar</span>();<br>	&#125;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(c)) a=a*<span class="hljs-number">10</span>+c-<span class="hljs-string">&#x27;0&#x27;</span>, c=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> a*f;<br>&#125;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">505</span>, M=<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">8</span>;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> pr[<span class="hljs-number">8</span>]=&#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">13</span>,<span class="hljs-number">17</span>,<span class="hljs-number">19</span>&#125;;<br><span class="hljs-type">int</span> n, mod;<br><span class="hljs-type">int</span> f[M][M], g1[M][M], g2[M][M];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span> &#123;<br>	<span class="hljs-type">int</span> sp, bp;<br>&#125; a[N];<br><span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>&lt;(node a,node b) &#123;<br>	<span class="hljs-keyword">return</span> a.bp&lt;b.bp;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	n=<span class="hljs-built_in">read</span>(), mod=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;n;++i) &#123;<br>		<span class="hljs-type">int</span> t=i+<span class="hljs-number">1</span>;<br>		<span class="hljs-built_in">rep</span>(j,<span class="hljs-number">0</span>,<span class="hljs-number">7</span>) <span class="hljs-keyword">if</span>(t%pr[j]==<span class="hljs-number">0</span>) &#123;<br>			a[i].sp|=<span class="hljs-number">1</span>&lt;&lt;j;<br>			<span class="hljs-keyword">while</span>(t%pr[j]==<span class="hljs-number">0</span>) t/=pr[j];<br>		&#125;<br>		<span class="hljs-keyword">if</span>(t&gt;<span class="hljs-number">1</span>) a[i].bp=t;<br>	&#125;<br>	<span class="hljs-built_in">sort</span>(a+<span class="hljs-number">1</span>,a+n);<br>	f[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;n;++i) &#123;<br>		<span class="hljs-keyword">if</span>(a[i].bp==<span class="hljs-number">0</span>||a[i].bp!=a[i<span class="hljs-number">-1</span>].bp) &#123;<br>            <span class="hljs-comment">// 新的等价类</span><br>			<span class="hljs-built_in">per</span>(S1,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>) <span class="hljs-built_in">per</span>(S2,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">if</span>((S1&amp;S2)==<span class="hljs-number">0</span>) &#123;<br>				 g1[S1][S2]=g2[S1][S2]=f[S1][S2];<br>			&#125;	<br>		&#125;<br>		<span class="hljs-built_in">per</span>(S1,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>) <span class="hljs-built_in">per</span>(S2,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">if</span>((S1&amp;S2)==<span class="hljs-number">0</span>) &#123;<br>			<span class="hljs-keyword">if</span>((S1&amp;a[i].sp)==<span class="hljs-number">0</span>) (g2[S1][S2|a[i].sp]+=g2[S1][S2])%=mod;<br>			<span class="hljs-keyword">if</span>((S2&amp;a[i].sp)==<span class="hljs-number">0</span>) (g1[S1|a[i].sp][S2]+=g1[S1][S2])%=mod;<br>		&#125;<br>		<span class="hljs-keyword">if</span>(i==n<span class="hljs-number">-1</span>||a[i].bp==<span class="hljs-number">0</span>||a[i].bp!=a[i+<span class="hljs-number">1</span>].bp) &#123;<br>            <span class="hljs-comment">// 下一个数是新的等价类</span><br>			<span class="hljs-built_in">per</span>(S1,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>) <span class="hljs-built_in">per</span>(S2,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">if</span>((S1&amp;S2)==<span class="hljs-number">0</span>) &#123;<br>				f[S1][S2]=((g1[S1][S2]+g2[S1][S2])%mod-f[S1][S2]+mod)%mod;<br>			&#125;<br>		&#125;<br>	&#125;<br>	<span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>	<span class="hljs-built_in">rep</span>(S1,<span class="hljs-number">0</span>,<span class="hljs-number">255</span>) <span class="hljs-built_in">rep</span>(S2,<span class="hljs-number">0</span>,<span class="hljs-number">255</span>) <span class="hljs-keyword">if</span>((S1&amp;S2)==<span class="hljs-number">0</span>) &#123;<br>		(ans+=f[S1][S2])%=mod;<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>,ans);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="luogu6239-jxoi2012-奇怪的道路">luogu6239 [JXOI2012] 奇怪的道路</h3><p>设 <span class="math inline">\(f(i,j,S)\)</span> 为考虑了 <span class="math inline">\([1,i]\)</span> 中的点，连了 <span class="math inline">\(j\)</span> 条边，<span class="math inline">\([i-k,i]\)</span> 中点的奇偶性为 <span class="math inline">\(S\)</span> 的方案数。</p><p>貌似可以直接做了。</p><h3 id="luogu3943-星空">luogu3943 星空</h3><p>Starry Sky.</p><p><a target="_blank" rel="noopener" href="https://yozora0908.github.io/2023/lg3943-solution">link</a></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Record/" class="category-chain-item">Record</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E8%AE%A1%E6%95%B0/" class="print-no-link">#计数</a> <a href="/tags/DP/" class="print-no-link">#DP</a> <a href="/tags/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9/" class="print-no-link">#状态压缩</a> <a href="/tags/%E6%95%B0%E8%AE%BA/" class="print-no-link">#数论</a> <a href="/tags/%E5%8C%BA%E9%97%B4DP/" class="print-no-link">#区间DP</a></div></div><div class="license-box my-3"><div class="license-title"><div>「NOIP Record」#9 状态压缩</div><div>https://yozora0908.top/2023/noip-record-9/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>来宮揚羽</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年7月15日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/lg3943-solution/" title="luogu3943 星空 题解"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">luogu3943 星空 题解</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/noip-record-8/" title="「NOIP Record」#8 搜索剪枝与记忆化搜索"><span class="hidden-mobile">「NOIP Record」#8 搜索剪枝与记忆化搜索</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments"><div id="giscus" class="giscus"></div><script type="text/javascript">Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"yozora0908/MyGiscus","repo-id":"R_kgDOKLq9Ag","category":"Announcements","category-id":"DIC_kwDOKLq9As4CY38c","theme-light":"light_protanopia","theme-dark":"dark_protanopia","mapping":"title","reactions-enabled":1,"emit-metadata":0,"input-position":"top","lang":"zh-CN","loading":"lazy","strict":1};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'light_protanopia';
        var dark = 'dark_protanopia';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;0<t.find(".toc-list-item").length&&t.css("visibility","visible")}}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script>if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });</script><script src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js"></script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>